{% extends 'base.html' %}

{% block title %}{{ post.title }}{% endblock %}

{% block content %}
  <div class="container mt-4">
    <h2>{{ post.title|default:"(–ë–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞)" }}</h2>
    <p><strong>–ê–≤—Ç–æ—Ä:</strong> {{ post.author.username }}</p>
    <p><strong>–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:</strong> {{ post.publication_date|date:"d M Y H:i" }}</p>

    <!-- –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∂–µ–Ω–æ –ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
    {% if post.image %}
      <img src="{{ post.image.url }}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Å—Ç–∞" class="img-fluid my-3">
    {% endif %}

    <p>{{ post.text }}</p>

    <hr>

    <!-- –ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∞ –ø–æ—Å—Ç–∞) -->
    {% if user == post.author %}
      <a href="{% url 'posts:post_update' post.slug %}" class="btn btn-warning mt-3">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
    {% endif %}

    <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
    <ul>
      {% for comment in post.comments.all %}
        <li><strong>{{ comment.author.username }}</strong>: {{ comment.text }}</li>
      {% empty %}
        <li>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</li>
      {% endfor %}
    </ul>

    <!-- –§–æ—Ä–º–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
    <h4>–û—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</h4>
    {% if user.is_authenticated %}
    <form method="post">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit" class="btn btn-primary mt-2">–î–æ–±–∞–≤–∏—Ç—å</button>
    </form>
    {% else %}
  <p class="text-danger">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <a href="{% url 'login' %}">–≤–æ–π—Ç–∏</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.</p>
    {% endif %}
    <a href="{% url 'posts:post_list' %}" class="btn btn-secondary mt-3">–ù–∞–∑–∞–¥</a>

  </div>
{% endblock %}

{% block extra_js %}
<script>
  document.getElementById('like-button').addEventListener('click', function () {
    fetch("{% url 'posts:like_post' post.slug %}", {
      method: "POST",
      headers: {
        'X-CSRFToken': '{{ csrf_token }}',
        'X-Requested-With': 'XMLHttpRequest',
      },
    })
    .then(res => res.json())
    .then(data => {
      if (data) {
        document.getElementById('like-count').textContent = data.likes_count;
        document.getElementById('like-icon').innerHTML = data.liked ? 'üëç' : '<span style="color: white;">üëç</span>';
        document.getElementById('dislike-icon').innerHTML = '<span style="color: white;">üëé</span>';
      }
    });
  });

  document.getElementById('dislike-button').addEventListener('click', function () {
    fetch("{% url 'posts:dislike_post' post.slug %}", {
      method: "POST",
      headers: {
        'X-CSRFToken': '{{ csrf_token }}',
        'X-Requested-With': 'XMLHttpRequest',
      },
    })
    .then(res => res.json())
    .then(data => {
      if (data) {
        document.getElementById('dislike-count').textContent = data.dislikes_count;
        document.getElementById('dislike-icon').innerHTML = data.disliked ? 'üëé' : '<span style="color: white;">üëé</span>';
        document.getElementById('like-icon').innerHTML = '<span style="color: white;">üëç</span>';
      }
    });
  });
</script>
{% endblock %}
