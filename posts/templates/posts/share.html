<!-- posts/templates/posts/share.html" -->

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" -->
<div class="modal fade" id="shareModal" tabindex="-1" aria-labelledby="shareModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="shareForm">
        <div class="modal-header">
          <h5 class="modal-title" id="shareModalLabel">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –ø–æ—Å—Ç–æ–º</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="platform" class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É:</label>
            <select class="form-select" id="platform" required>
              <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
              <option value="email">üìß Email</option>
              <option value="whatsapp">üì± WhatsApp</option>
              <option value="telegram">‚úàÔ∏è Telegram</option>
              <option value="facebook">üìò Facebook</option>
              <option value="instagram">üì∏ Instagram</option>
            </select>
          </div>
          <div class="mb-3" id="contactInput"></div>
          <input type="hidden" id="shareUrl">
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  let currentPostUrl = "";

  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.share-button').forEach(button => {
      button.addEventListener('click', function () {
        const slug = this.getAttribute('data-slug');
        const url = `${window.location.origin}/posts/${slug}/`;
        document.getElementById('shareUrl').value = url;
        currentPostUrl = url;
        document.getElementById('platform').value = "";
        document.getElementById('contactInput').innerHTML = "";
      });
    });

    document.getElementById('platform').addEventListener('change', function () {
      const platform = this.value;
      const contactInput = document.getElementById('contactInput');

      if (platform === "email") {
        contactInput.innerHTML = `
          <label for="email" class="form-label">Email –ø–æ–ª—É—á–∞—Ç–µ–ª—è:</label>
          <input type="email" class="form-control" id="email" required>
        `;
      } else if (platform === "whatsapp" || platform === "telegram") {
        contactInput.innerHTML = `
          <label for="phone" class="form-label">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:</label>
          <input type="tel" class="form-control" id="phone" required>
        `;
      } else {
        contactInput.innerHTML = "<p class='text-muted'>–°—Å—ã–ª–∫–∞ –±—É–¥–µ—Ç –æ—Ç–∫—Ä—ã—Ç–∞ –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ.</p>";
      }
    });

    document.getElementById('shareForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const platform = document.getElementById('platform').value;
      const url = currentPostUrl;

      if (platform === "email") {
        const email = document.getElementById('email').value;
        window.location.href = `mailto:${email}?subject=–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –ø–æ—Å—Ç&body=–°–º–æ—Ç—Ä–∏: ${url}`;
      } else if (platform === "whatsapp") {
        const phone = document.getElementById('phone').value.replace(/\D/g, '');
        window.open(`https://wa.me/${phone}?text=${encodeURIComponent(url)}`, '_blank');
      } else if (platform === "telegram") {
        window.open(`https://t.me/share/url?url=${encodeURIComponent(url)}&text=–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –ø–æ—Å—Ç`, '_blank');
      } else if (platform === "facebook") {
        window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, '_blank');
      } else if (platform === "instagram") {
        alert("Instagram –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä—è–º–æ–π —à–∞—Ä–∏–Ω–≥. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –≤—Ä—É—á–Ω—É—é.");
      }

      bootstrap.Modal.getInstance(document.getElementById('shareModal')).hide();
    });
  });
</script>
