<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid" style="padding-right: 40px;">
        <a class="navbar-brand me-3" href="#">Chatty</a>

        <!-- üîç –ü–æ–ª–µ –ø–æ–∏—Å–∫–∞ —Å –∞–≤—Ç–æ–ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏ -->
        <form action="{% url 'search' %}" method="GET" class="d-flex flex-grow-1">
            <div class="input-group" style="max-width: 900px;">
                <input type="text" id="search-box" name="q" class="form-control rounded-pill ps-4"
                    placeholder="üîç –ù–∞–π—Ç–∏ –ø–æ—Å—Ç..." style="height: 32px;" onkeyup="showSuggestions(this.value)">
                <ul id="suggestions-list" class="list-group position-absolute w-100"></ul>
            </div>
        </form>

        <ul class="navbar-nav d-flex align-items-center gap-3 ms-auto">
            <li class="nav-item">
                <a class="nav-link" href="{% url 'home' %}">–ì–ª–∞–≤–Ω–∞—è</a>
            </li>
            {% if user.is_authenticated %}
            <li class="nav-item d-flex align-items-center">
                <img src="{% if user.avatar %}{{ user.avatar.url }}{% else %}{{ MEDIA_URL }}avatars/default.png{% endif %}"
                    alt="–ê–≤–∞—Ç–∞—Ä" class="rounded-circle" width="40" height="40" style="object-fit: cover; margin-right: 8px;">
                <a class="nav-link" href="{% url 'profile' username=user.username %}">{{ user.username }}</a>
            </li>
            <li class="nav-item">
                <form method="POST" action="{% url 'logout' %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="nav-link btn btn-link text-white">–í—ã—Ö–æ–¥</button>
                </form>
            </li>
            {% else %}
            <li class="nav-item">
                <a class="nav-link" href="{% url 'login' %}">–í–æ–π—Ç–∏</a>
            </li>
            <li class="nav-item">
                <a class="nav-link btn btn-primary text-white" href="{% url 'register' %}">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            </li>
            {% endif %}
        </ul>
    </div>
</nav>

<script>
function showSuggestions(query) {
    if (query.length < 2) {
        document.getElementById("suggestions-list").innerHTML = "";
        return;
    }

    fetch(`/search/suggestions/?q=${query}`)
        .then(response => response.json())
        .then(data => {
            let suggestionsList = document.getElementById("suggestions-list");
            suggestionsList.innerHTML = "";
            data.forEach(title => {
                let item = document.createElement("li");
                item.className = "list-group-item";
                item.innerHTML = `<a href="/search/?q=${title}" class="text-dark text-decoration-none">${title}</a>`;
                suggestionsList.appendChild(item);
            });
        });
}
</script>

<style>
#suggestions-list {
    list-style-type: none;
    padding: 0;
    position: absolute;
    background: white;
    width: 100%;
    border: 1px solid #ddd;
    max-height: 200px;
    overflow-y: auto;
    z-index: 1000;
}

#suggestions-list li:hover {
    background: #f0f0f0;
    cursor: pointer;
}
</style>
