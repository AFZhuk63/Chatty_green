{# users/templates/users/profile.html #}

{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <h2>–ü—Ä–æ—Ñ–∏–ª—å {{ profile_user.username|capfirst }}</h2>
    <div class="row">
        <div class="col-md-3">
            <img src="{% if profile_user.avatar %}{{ profile_user.avatar.url }}{% else %}/media/avatars/default.png{% endif %}"
                 alt="–ê–≤–∞—Ç–∞—Ä" class="img-thumbnail" width="200">
        </div>
        <div class="d-flex flex-column gap-2">
            <p><strong>Email:</strong> {{ profile_user.email }}</p>
            <p><strong>–û —Å–µ–±–µ:</strong> {{ profile_user.bio|default:"–ù–µ —É–∫–∞–∑–∞–Ω–æ" }}</p>

            {% if request.user == profile_user %}
                 {% if request.user.is_banned %}
                  <p><strong>–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å –∑–∞–±–∞–Ω–Ω–µ–Ω</strong></p>
                  <p><strong>–ü—Ä–∏—á–∏–Ω–∞ –±–∞–Ω–Ω–∞</strong> {{request.user.ban_reason}}</p>
                  <p><strong>–°—Ä–æ–∫ –±–∞–Ω–Ω–∞</strong> {{request.user.banned_until}}</p>

                 {% else %}

                <a href="{% url 'edit_profile' username=profile_user.username %}" class="btn btn-primary">
                    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
                </a>
                <a href="{% url 'change_password' %}" class="btn btn-warning">
                    –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
                </a>
                {% endif %}
            {% else %}
                <form class="d-inline" method="post" action="{% url 'subscriptions:toggle' profile_user.username %}">
                    {% csrf_token %}
                    <button type="submit"
                        class="btn subscription-toggle {% if is_subscribed %}btn-outline-secondary{% else %}btn-primary{% endif %}"
                        data-username="{{ profile_user.username }}">
                        {% if is_subscribed %}
                            <i class="fa-solid fa-user-minus me-1"></i>–û—Ç–ø–∏—Å–∞—Ç—å—Å—è
                        {% else %}
                            <i class="fa-solid fa-user-plus me-1"></i>–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è
                        {% endif %}
                    </button>
                </form>
            {% endif %}

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫ -->
            <p>
                –ü–æ–¥–ø–∏—Å—á–∏–∫–æ–≤: <span id="subscribers-count">{{ profile_user.followers.count|default:"0" }}</span>
                &nbsp;|&nbsp;
                –ü–æ–¥–ø–∏—Å–æ–∫: {{ profile_user.subscriptions.count|default:"0" }}
            </p>


            <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –≤—ã–≤–æ–¥ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å—Ç–∞—Ç–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
            <div class="profile-posts mt-4">
                <h3>–°—Ç–∞—Ç—å–∏</h3>
                {% if user_posts %}
                    {% for post in user_posts %}
                        <div class="post-preview">
                            <h4>
                                <a href="{% url 'posts:post_detail' post.slug %}">{{ post.title }}</a>
                            </h4>
                            <p>{{ post.text|truncatechars:150 }}</p>
                        </div>
                    {% endfor %}
                {% else %}
                    <p>–ù–µ—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π.</p>
                {% endif %}
            </div>
            <!-- üî• –ù–æ–≤—ã–π –±–ª–æ–∫: –í—ã–≤–æ–¥ –≤–∏–¥–µ–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
            <div class="profile-videos mt-5">
                <h3>–í–∏–¥–µ–æ</h3>
                {% if user_videos %}
                    {% for video in user_videos %}
                        <div class="video-preview mb-3">
                            <h4>
                                <a href="{% url 'videopost:videopost_detail' video.slug %}">{{ video.title }}</a>
                            </h4>
                            {% if video.thumbnail %}
                                <img src="{{ video.thumbnail.url }}" alt="–ü—Ä–µ–≤—å—é" class="img-fluid mb-2" style="max-width: 50px;">
                            {% endif %}
                            <p>{{ video.description|truncatechars:150 }}</p>
                        </div>
                    {% endfor %}
                {% else %}
                    <p>–ù–µ—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ.</p>
                {% endif %}
            </div>

            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º –ø–æ–¥–ø–∏—Å–æ–∫ -->
            <p class="mt-3">
                <a href="{% url 'subscriptions:feed' %}">–õ–µ–Ω—Ç–∞</a> |
                <a href="{% url 'subscriptions:followers' profile_user.username %}">–ü–æ–¥–ø–∏—Å—á–∏–∫–∏</a> |
                <a href="{% url 'subscriptions:following' profile_user.username %}">–ü–æ–¥–ø–∏—Å–∫–∏</a>
            </p>
        </div>
    </div>
</div>
            <div class="mt-3">
              <strong>–ü–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –Ω–∞ videopost:</strong> {{ profile_user.subscribers.count }}
                <!-- –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å—á–µ—Ç—á–∏–∫–∞ Videopost –≤–º–µ—Å—Ç–µ –≤ Posts -->
            </div>
{% endblock %}

{% block scripts %}
    <script src="{% static 'subscriptions/js/subscriptions.js' %}"></script>
{% endblock %}
